<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quick Sort Visualization | DAA Project</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: Arial, sans-serif;
      background: #121212;
      color: #e0e0e0;
      padding: 20px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      margin-bottom: 20px;
    }

    h1 {
      font-size: 24px;
      margin-bottom: 5px;
    }

    .subtitle {
      font-size: 14px;
      color: #9e9e9e;
    }

    .controls {
      background: #1e1e1e;
      border: 1px solid #333;
      border-radius: 5px;
      padding: 15px;
      margin-bottom: 15px;
    }

    .input-row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      margin-bottom: 15px;
    }

    .input-row label {
      font-size: 14px;
      min-width: 150px;
    }

    input[type="text"] {
      flex: 1;
      min-width: 200px;
      padding: 8px;
      border: 1px solid #444;
      border-radius: 3px;
      font-size: 14px;
      background: #2d2d2d;
      color: #e0e0e0;
    }

    input[type="text"]:focus {
      outline: none;
      border-color: #4CAF50;
    }

    .btn {
      padding: 8px 16px;
      border: 1px solid #444;
      border-radius: 3px;
      font-size: 14px;
      cursor: pointer;
      background: #2d2d2d;
      color: #e0e0e0;
    }

    .btn:hover:not(:disabled) {
      background: #3d3d3d;
    }

    .btn-primary {
      background: #4CAF50;
      color: white;
      border-color: #4CAF50;
    }

    .btn-primary:hover:not(:disabled) {
      background: #45a049;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .slider-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
    }

    .slider-row label {
      font-size: 14px;
      min-width: 80px;
    }

    input[type="range"] {
      flex: 1;
      height: 5px;
    }

    .speed-value {
      font-size: 14px;
      min-width: 30px;
    }

    .buttons-row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .viz-container {
      background: #1e1e1e;
      border: 1px solid #333;
      border-radius: 5px;
      padding: 20px;
      min-height: 300px;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      gap: 3px;
      flex-wrap: wrap;
    }

    .bar-wrap {
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1;
      min-width: 30px;
      max-width: 50px;
      position: relative;
    }

    .bar-label {
      font-size: 11px;
      font-weight: bold;
      margin-bottom: 3px;
      height: 15px;
      color: #e0e0e0;
    }

    .bar {
      width: 100%;
      min-height: 10px;
      background: #4CAF50;
      border-radius: 3px 3px 0 0;
      transition: height 0.2s, background 0.2s;
    }

    .bar.pivot {
      background: #ff6b9d;
    }

    .bar.pointer-i {
      background: #2196F3;
    }

    .bar.pointer-j {
      background: #FFC107;
    }

    .bar.sorted {
      background: #4CAF50;
    }

    .bar.swapping {
      background: #9C27B0;
      animation: flicker 0.3s ease-in-out 3;
    }

    @keyframes flicker {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .bar-value {
      font-size: 11px;
      margin-top: 4px;
      color: #9e9e9e;
    }

    .separator {
      width: 3px;
      height: 100%;
      background: #ff4444;
      margin: 0 5px;
      min-height: 200px;
    }

    .legend {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 15px;
      font-size: 13px;
    }

    .legend span {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .legend .dot {
      width: 12px;
      height: 12px;
      border-radius: 2px;
    }

    .legend .dot.pivot { background: #ff6b9d; }
    .legend .dot.pointer-i { background: #2196F3; }
    .legend .dot.pointer-j { background: #FFC107; }
    .legend .dot.sorted { background: #4CAF50; }
    .legend .dot.normal { background: #4CAF50; }

    .status {
      text-align: center;
      margin-top: 15px;
      font-size: 14px;
      color: #9e9e9e;
      min-height: 20px;
    }

    .time-info {
      text-align: center;
      margin-top: 10px;
      font-size: 13px;
      color: #9e9e9e;
    }

    .copy-btn {
      margin-top: 10px;
    }

    .error {
      color: #ff6b6b;
      font-size: 13px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Quick Sort Visualization</h1>
      <p class="subtitle">DAA Project — Enter numbers or generate random</p>
    </header>

    <div class="controls">
      <div class="input-row">
        <label for="numbers">Numbers (space-separated):</label>
        <input type="text" id="numbers" placeholder="e.g. 64 34 25 12 22 11 90 23 21 94 21 20 89 19 37 55 77 46 7">
        <button type="button" class="btn" id="randomBtn">Random</button>
      </div>
      <div class="slider-row">
        <label for="speed">Speed:</label>
        <input type="range" id="speed" min="1" max="100" value="50">
        <span class="speed-value" id="speedValue">50</span>
      </div>
      <div class="buttons-row">
        <button type="button" class="btn btn-primary" id="startBtn">Start Sort</button>
        <button type="button" class="btn" id="pauseBtn" disabled>Pause</button>
        <button type="button" class="btn" id="resetBtn">Reset</button>
      </div>
      <div id="inputError" class="error"></div>
    </div>

    <div class="viz-container" id="vizContainer"></div>
    <div class="legend">
      <span><span class="dot normal"></span> Element</span>
      <span><span class="dot pivot"></span> Pivot</span>
      <span><span class="dot pointer-i"></span> i (left→right)</span>
      <span><span class="dot pointer-j"></span> j (right→left)</span>
      <span><span class="dot sorted"></span> Fixed</span>
    </div>
    <p class="status" id="status">Enter numbers and click Start Sort</p>
    <p class="time-info" id="timeInfo"></p>
    <div style="text-align: center;">
      <button type="button" class="btn copy-btn" id="copyBtn" style="display: none;">Copy Sorted List</button>
    </div>
  </div>

  <script>
    const numbersInput = document.getElementById('numbers');
    const randomBtn = document.getElementById('randomBtn');
    const speedSlider = document.getElementById('speed');
    const speedValue = document.getElementById('speedValue');
    const startBtn = document.getElementById('startBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const resetBtn = document.getElementById('resetBtn');
    const vizContainer = document.getElementById('vizContainer');
    const statusEl = document.getElementById('status');
    const inputError = document.getElementById('inputError');
    const timeInfo = document.getElementById('timeInfo');
    const copyBtn = document.getElementById('copyBtn');

    let steps = [];
    let stepIndex = 0;
    let timerId = null;
    let isPaused = false;
    let initialArray = [];
    let executionTime = 0;
    let sortedArray = [];

    function getSpeedDelay() {
      const v = parseInt(speedSlider.value, 10);
      return Math.max(50, 520 - v * 5);
    }

    speedSlider.addEventListener('input', () => {
      speedValue.textContent = speedSlider.value;
    });

    randomBtn.addEventListener('click', () => {
      const arr = Array.from({ length: 20 }, () => 10 + Math.floor(Math.random() * 90));
      numbersInput.value = arr.join(' ');
      inputError.textContent = '';
    });

    function parseInput() {
      const raw = numbersInput.value.trim();
      if (!raw) return null;
      const parts = raw.split(/\s+/);
      const nums = parts.map(s => parseInt(s, 10));
      if (nums.some(n => isNaN(n))) return null;
      return nums;
    }

    function quickSortWithSteps(arr) {
      const startTime = performance.now();
      steps = [];
      const a = [...arr];
      const fixed = [];

      // Helper: save current snapshot (array + fixed indices + optional meta)
      function record(type, meta = {}) {
        steps.push({
          array: [...a],
          fixedIndices: [...fixed],
          type,
          ...meta
        });
      }

      function partition(low, high) {
        const pivotVal = a[low];
        let i = low + 1;
        let j = high;
        record('pivot', { pivotIndex: low, i, j, low, high });

        while (true) {
          while (i <= j && a[i] <= pivotVal) {
            record('pointer', { pivotIndex: low, i, j, low, high });
            i++;
          }
          while (i <= j && a[j] > pivotVal) {
            record('pointer', { pivotIndex: low, i, j, low, high });
            j--;
          }
          if (i < j) {
            [a[i], a[j]] = [a[j], a[i]];
            record('swap_ij', { pivotIndex: low, i, j, low, high });
            i++;
            j--;
          } else {
            break;
          }
        }
        [a[low], a[j]] = [a[j], a[low]];
        fixed.push(j);
        record('pivot_fixed', { pivotIndex: low, fixedPos: j, low, high });
        return j;
      }

      function quickSort(low, high) {
        if (low < high) {
          const p = partition(low, high);
          quickSort(low, p - 1);
          quickSort(p + 1, high);
        }
      }

      record('init');
      quickSort(0, a.length - 1);
      record('done');
      const endTime = performance.now();
      executionTime = endTime - startTime;
      sortedArray = [...a];
      return steps;
    }

    function renderBars(step, fixedSet, showSeparators) {
      vizContainer.innerHTML = '';
      const { array, type, pivotIndex, i, j } = step;
      const maxVal = Math.max(...array, 1);

      array.forEach((val, idx) => {
        const wrap = document.createElement('div');
        wrap.className = 'bar-wrap';
        const label = document.createElement('div');
        label.className = 'bar-label';
        if (type === 'pivot' && idx === pivotIndex) label.textContent = 'PIVOT';
        else if (type !== 'pivot_fixed' && idx === i) label.textContent = 'i';
        else if (type !== 'pivot_fixed' && idx === j) label.textContent = 'j';
        wrap.appendChild(label);

        const bar = document.createElement('div');
        bar.className = 'bar';
        bar.style.height = (val / maxVal) * 180 + 'px';
        if (type === 'swap_ij' && (idx === i || idx === j)) {
          bar.classList.add('swapping');
        } else if (type === 'done' || fixedSet.has(idx)) {
          bar.classList.add('sorted');
        } else if (idx === pivotIndex && type !== 'pivot_fixed') {
          bar.classList.add('pivot');
        } else if (type !== 'pivot_fixed' && idx === i) {
          bar.classList.add('pointer-i');
        } else if (type !== 'pivot_fixed' && idx === j) {
          bar.classList.add('pointer-j');
        }
        wrap.appendChild(bar);

        const valEl = document.createElement('div');
        valEl.className = 'bar-value';
        valEl.textContent = val;
        wrap.appendChild(valEl);
        vizContainer.appendChild(wrap);

        if (showSeparators && fixedSet.has(idx) && idx < array.length - 1 && !fixedSet.has(idx + 1)) {
          const sep = document.createElement('div');
          sep.className = 'separator';
          vizContainer.appendChild(sep);
        }
      });
    }

    function playNext() {
      if (isPaused || stepIndex >= steps.length) {
        if (stepIndex >= steps.length && steps.length) {
          const last = steps[steps.length - 1];
          const allFixed = new Set(last.array.map((_, i) => i));
          renderBars(last, allFixed, false);
          statusEl.textContent = 'Sorting complete!';
          timeInfo.textContent = `Execution time: ${executionTime.toFixed(2)} ms`;
          copyBtn.style.display = 'inline-block';
          startBtn.disabled = false;
          pauseBtn.disabled = true;
          pauseBtn.textContent = 'Pause';
        }
        return;
      }
      const step = steps[stepIndex];
      const fixedSet = step.type === 'done' ? new Set(step.array.map((_, i) => i)) : new Set(step.fixedIndices || []);
      renderBars(step, fixedSet, step.type !== 'done');

      const msg = { pivot: `Pivot = first (${step.array[step.pivotIndex]}). i=${step.i}, j=${step.j}.`, pointer: `Moving i and j. i=${step.i}, j=${step.j}.`, swap_ij: 'i left of j → swap i and j.', pivot_fixed: `Pivot fixed at pos ${step.fixedPos + 1}. Split into 2.`, done: 'Done!' };
      statusEl.textContent = msg[step.type] || `Step ${stepIndex + 1}/${steps.length}`;

      stepIndex++;
      let delay = getSpeedDelay();
      if (step.type === 'swap_ij' || step.type === 'pivot_fixed') delay *= 2.5;
      timerId = setTimeout(playNext, delay);
    }

    function startSort() {
      const arr = parseInput();
      if (!arr || arr.length === 0) {
        inputError.textContent = 'Enter valid space-separated numbers.';
        return;
      }
      inputError.textContent = '';
      initialArray = arr;
      timeInfo.textContent = '';
      copyBtn.style.display = 'none';
      steps = quickSortWithSteps(arr);
      stepIndex = 0;
      isPaused = false;
      pauseBtn.textContent = 'Pause';
      pauseBtn.disabled = false;
      startBtn.disabled = true;
      statusEl.textContent = 'Running...';
      playNext();
    }

    function pauseResume() {
      if (stepIndex >= steps.length) return;
      isPaused = !isPaused;
      pauseBtn.textContent = isPaused ? 'Resume' : 'Pause';
      if (timerId) clearTimeout(timerId);
      timerId = null;
      if (!isPaused) playNext();
    }

    function reset() {
      if (timerId) clearTimeout(timerId);
      timerId = null;
      isPaused = false;
      stepIndex = 0;
      steps = [];
      executionTime = 0;
      sortedArray = [];
      timeInfo.textContent = '';
      copyBtn.style.display = 'none';
      startBtn.disabled = false;
      pauseBtn.disabled = true;
      pauseBtn.textContent = 'Pause';
      if (initialArray.length) {
        renderBars({ array: initialArray, type: 'init' }, new Set(), false);
        numbersInput.value = initialArray.join(' ');
      } else vizContainer.innerHTML = '';
      statusEl.textContent = initialArray.length ? 'Reset. Click Start Sort.' : 'Enter numbers and click Start Sort';
    }

    copyBtn.addEventListener('click', () => {
      if (sortedArray.length > 0) {
        const text = sortedArray.join(' ');
        navigator.clipboard.writeText(text).then(() => {
          copyBtn.textContent = 'Copied!';
          setTimeout(() => {
            copyBtn.textContent = 'Copy Sorted List';
          }, 2000);
        }).catch(() => {
          const textarea = document.createElement('textarea');
          textarea.value = text;
          document.body.appendChild(textarea);
          textarea.select();
          document.execCommand('copy');
          document.body.removeChild(textarea);
          copyBtn.textContent = 'Copied!';
          setTimeout(() => {
            copyBtn.textContent = 'Copy Sorted List';
          }, 2000);
        });
      }
    });

    startBtn.addEventListener('click', startSort);
    pauseBtn.addEventListener('click', pauseResume);
    resetBtn.addEventListener('click', reset);
  </script>
</body>
</html>
